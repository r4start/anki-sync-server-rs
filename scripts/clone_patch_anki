#!/bin/sh
# set -eu

PROJECT_ROOT=$(realpath)   # or result=`myfunc`
ANKI_REPO_URL=${ANKI_REPO_URL:-"https://github.com/ankitects/anki"}
ANKI_COMMIT=d9d36078f17a2b4b8b44fcb802eb274911ebabe7

#PROJECT_ROOT="$(realpath "$(dirname "$(dirname "$0")")")"
ANKI_PATCH_FOLDER="$PROJECT_ROOT./anki_patch/"
ANKI_FILE_SUFFIX="_anki_rslib.patch"

echo "Cloning anki from $ANKI_REPO_URL"
cd "$PROJECT_ROOT"
# remove anki lib in case patched cache exists in docker build during github action
rm -fr anki
git clone "$ANKI_REPO_URL"
echo "Checking out commit $ANKI_COMMIT and applying patch"
cd anki
git checkout $ANKI_COMMIT
git apply "$ANKI_PATCH_FOLDER/$ANKI_COMMIT$ANKI_FILE_SUFFIX"
